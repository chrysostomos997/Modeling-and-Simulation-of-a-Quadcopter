%%LQR CONTROL IN SIMULINK 

%state space 
A=[0 0 0 0 0 0 1 0 0 0 0 0;
   0 0 0 0 0 0 0 1 0 0 0 0;
   0 0 0 0 0 0 0 0 1 0 0 0;
   0 0 0 0 0 0 0 0 0 1 0 0;
   0 0 0 0 0 0 0 0 0 0 1 0; 
   0 0 0 0 0 0 0 0 0 0 0 1;
   0 0 0 0 0 0 0 0 0 0 0 0;
   0 0 0 0 0 0 0 0 0 0 0 0; 
   0 0 0 0 0 0 0 0 0 0 0 0;
   0 -9.8 0 0 0 0 0 0 0 0 0 0;
   9.8 0 0 0 0 0 0 0 0 0 0 0;
   0 0 0 0 0 0 0 0 0 0 0 0;];
B=[0 0 0 0;
   0 0 0 0; 
   0 0 0 0; 
   0 0 0 0;
   0 0 0 0;
   0 0 0 0; 
   0 10 0 0; 
   0 0 10 0;
   0 0 0 6.6667;
   0 0 0 0;
   0 0 0 0; 
   5 0 0 0;];
C=diag([1,1,1,1,1,1,1,1,1,1,1,1]);
D=[0 0 0 0;
   0 0 0 0;
   0 0 0 0;
   0 0 0 0;
   0 0 0 0; 
   0 0 0 0; 
   0 0 0 0;
   0 0 0 0; 
   0 0 0 0;
   0 0 0 0; 
   0 0 0 0; 
   0 0 0 0; ]
   
sys=ss(A,B,C,D);
%LQR for control

Q = sys.C'*sys.C;    
R = eye(4);



   
 x0 = zeros(12,1);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%LQR control 
[K,s,p]=lqr(sys,Q,R);       

                              %%AFTER
                              %%kz=ka(1,3);
                              %%kx=ka(1,[1,2]);


%% GIA TO L 
Qn = 1e-03*diag([ 1 1 1 1 1])
Rn=10;
[kest,L,p] = kalman (ss(A,[B,[1;1;1;1;1;1;1;1;1;1;1;1]],C,0),Qn,Rn);



%%-------------------------------LQI------------------$$
%%efarmogi LQI 




%Co = ctrb(sys);
%C=rank(Co);
%Ob=obsv(sys);
%O=rank(Ob);
rank=rank(ctrb(sys))
Q=eye(24);
R=eye(4); 

[ka,s,p]=lqi(sys,Q,R)

sysaugmented = series(sys,ss(zeros(12),eye(12),eye(12),0));

